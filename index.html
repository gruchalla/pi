<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="author" content="Kenny Gruchalla">
    <title>Walking the digits of &pi;</title>
    <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
      border: 0;
      overflow: hidden; /*  Disable scrollbars */
      display: block;  /* No floating content on sides */
    }
    div.title {
          position: absolute;
          z-index: 1;
          left: 10px;
          top: 10px;
          width:100%;
          height:10px;
          background-color: transparent;
          color:white;
          text-align:left;
    }
    div.info {
        position: absolute;
        z-index: 1;
        right: 160px;
        bottom: 20px;
        background-color:
        transparent;
        width:400px;
        color:white;
        text-align:left;
        font-size:1vw;
    }
    div.key {
        position: absolute;
        z-index: 1;
        right: 10px;
        bottom: 20px;
        background-color: transparent;
        color:white;
        text-align:center;
    }
    </style>
</head>

<body>
    <canvas id='c' style='position:relative; left:0px; top:0px;'>
    </canvas>
    <div class="title">
        <div style="font-weight:bold; font-size:3vw;">Walking the digits of &pi;</div>
        <div>
          <span style="font-size:2vw">Happy &pi; Day!</span>
          <span style="font-size:1vw"><i>from the NREL vis team</i></span><br>
        </div>
    </div>
    
    <div class="info">
     The visualization shows a deterministic walk generated by the first 100,000 digit expansion of &pi;. The walk takes a step in one of ten 36&deg; increments depending on the digit. The colormap repeats every 10,000 digits.
    </div>
    
    <div class="key"> <img src="key.png" style="width:150px;height:auto;"> </div>
    
    <script src="100000.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v0.3.min.js"></script>

    <script>
    (function() {

        var canvas = document.getElementById('c');
        var context = canvas.getContext('2d');

        const stepsize = 5;
        const ndigits = 100000;
        const ncolors = 10000;
        const fps = 30;
        
        var point = {"x" : window.innerWidth / 2 , "y" : window.innerHeight / 2 };
        
        var idx = 0;
        var colors = d3.scaleSequential(d3.interpolateOranges).domain([0,ncolors]);
        var ticker_width = 100;
        
       //xwindow.requestAnimationFrame(draw);
       
       // Start listening to resize events and draw canvas.
       initialize();

       function initialize() {
           // Register an event listener to call the resizeCanvas() function 
           // each time the window is resized.
           window.addEventListener('resize', resizeCanvas, false);

           // Draw canvas border for the first time.
           resizeCanvas();
        }

        // Take a step down pi
        function draw() {

           setTimeout(function() {
             var wrapped = false;
             var theta = pi[idx] * 0.628318530717959;

             context.beginPath();
             context.moveTo(point.x, point.y);
           
             point.x = point.x + Math.cos(theta) * stepsize;
             point.y = point.y + Math.sin(theta) * stepsize;

             //
             // Wrap if we've run off the window
             //
             if (point.x < 0) {
                  point.x = window.innerWidth + point.x;
                  wrapped = true;
             }
             if (point.y < 0) {
                  point.y = window.innerHeight + point.y;
                  wrapped = true;
             }
             if (point.x > window.innerWidth) {
                  point.x = point.x - window.innerWidth;
                  wrapped = true;
             }
             if (point.y > window.innerHeight) {
                  point.y = point.y - window.innerHeight;
                  wrapped = true;
             }
                

             if (wrapped) {
                // if we've wrapped just move the position, don't draw. Will be fine for
                // small step size, would need to get more sophisticated for larger step
                // sizes
                context.moveTo(point.x, point.y);
             }
             else {
                // Draw the step
                context.lineTo(point.x, point.y);
                context.strokeStyle = colors(idx % ncolors);
                context.lineWidth=1;
                context.stroke();
             }
           
             context.closePath();

             // Ticker text
             context.fillStyle = 'black';
             context.fillRect(0, window.innerHeight-14, window.innerWidth, 14);

             var ticker = pi.substring((idx<ticker_width) ? 0 : idx-ticker_width, idx+1);
             context.fillStyle = 'white';
             context.fillText(ticker, Math.max(5,window.innerWidth-idx*context.measureText("0").width), window.innerHeight-5);

             idx = (idx + 1) % ndigits;
             window.requestAnimationFrame(draw);
           }, 1000 / fps);

        }

        // Runs each time the DOM window resize event fires.
        // Resets the canvas dimensions to match window
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            context.fillStyle = 'black';
            context.fillRect(0, 0, window.innerWidth, window.innerHeight);
            context.font = "12px Courier New"

            ticker_width = parseInt(window.innerWidth / context.measureText("0").width);

            point.x = window.innerWidth / 2;
            point.y = window.innerHeight / 2;

            idx = 0;
            
            draw();
        }
    })();

    </script>
</body> 
</html>